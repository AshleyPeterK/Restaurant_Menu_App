#Project 5 - Linux Server Configuration

##Project Overview

###Description
The principal objective of this project is to deploy a web app that was developed for **Project 3 (Item Catalog)**of the Udacity Fullstack Web Developer Nanodegree program. This web app needs to be hosted on a virtual server 
in `Amazon’s Elastic Compute Cloud (EC2)`. 

###Aim
Configure a new Linux server to host a web application. This will involve performing the following major tasks:
- Installing software updates.
- Setting up a Web-server e.g Apache.
- Setting up a Database-server.
- Ensuring the best possible security. 

###Tools and technologies used
- Git
- Amazon’s Elastic Compute Cloud (EC2) 

##How to acesss the server
- IP address is **35.162.229.47**
- SSH port is **2200**
- Complete URL for the hosted web application is **ec2-35-162-229-47.us-west-2.compute.amazonaws.com** 

##Summary of software installed
- Installed Finger to check if new user created 

  `sudo apt-get install finger`
- Installed  Apache as the Web-server 

  `sudo apt-get install apache2`

- Installed mod_wsgi which is an Apache HTTP Server module

  `sudo apt-get install libapache2-mod-wsgi`    

- Installed  PostgreSQL as the Database-server

  `sudo apt-get install postgresql postgresql-contrib`

- Installed Git

  `sudo apt-get install git`

##Summary of configuration changes made
- Created a new user named **grader**

  `adduser grader`

- Check if the new user 'grader' is there

  `finger grader`  

- Gave the user 'grader' the permission to **sudo**

  `touch /etc/sudoers.d/grader` followed by

  `nano /etc/sudoers.d/grader` placed the text **grader ALL=(ALL:ALL)ALL**

- Updated all currently installed packages

  `sudo apt-get update` followed by

  `sudo apt-get upgrade`

- Changed the SSH port from 22 to 2200

  `nano /etc/ssh/sshd_config` , followed by `stop ssh` and `start ssh`

- Configured the **Uncomplicated Firewall (UFW)** to only allow incoming connections for SSH 
  (port 2200), HTTP (port 80), and NTP (port 123)

  `sudo ufw default deny incoming`

  `sudo ufw allow 2200/tcp`

  `sudo ufw allow 80/tcp`

  `sudo ufw allow 123/udp`

  `sudo ufw enable`

- Enforced Key-based authentication

  `ssh-keygen`

  `ssh-copy-id grader@35.162.229.47 -p 2200`

  - Created a Pass Phrase which is **anderson1#**

  - Disabled both **Root Login** and **Password Authentication**
      
     `sudo nano /etc/ssh/sshd_config` and set 'PasswordAuthentication' to **no** and 'PermitRootLogin' to **no**
  - the user 'grader' can login now with `ssh grader@35.162.229.47 -p 2200`  

- Configured the local timezone to **UTC**

  `sudo dpkg-reconfigure tzdata` select 'None of the above' and then 'UTC'

- Configured the PostgreSQL database-server to properly serve data for **Python Flask Web 
Application ( Restaurant Menu Application)**

  `sudo nano /etc/postgresql/9.3/main/pg_hba.conf` ensures that remote connections are not allowed.

  - create user **catalog** with limited permissions
  `sudo su - postgres`

  `psql`
  
  `CREATE USER catalog WITH PASSWORD '[THE_USERS_PASSWORD]' CREATEDB;`
  
  `\du`
  
  `CREATE DATABASE restaurantmenuwithusers WITH OWNER catalog;`

  `\c restaurantmenuwithusers` 

  `REVOKE ALL ON SCHEMA public FROM public;` 

  `GRANT ALL ON SCHEMA public TO catalog;`

  `\q`

  `exit` 

- Setup Git as follows:

  `git config --global user.name "Ashley peter"`
  `git config --global user.email "ashpk@ymail.com"`

- Configured Apache web-server to serve  the Python Flask Web Application ( Restaurant Menu Application)

  `cd /var/www`

  `sudo mkdir restaurantmenuapp`

  `cd restaurantmenuapp` then clone the **Restaurant Menu Application** from AshleyPeterK/restaurantmenuapp github repository

  `sudo git clone https://github.com/AshleyPeterK/restaurantmenuapp.git`

  - Make .git directory by `sudo nano .htaccess` and the line **RedirectMatch 404 /\.git**

  - change application.py to __init__.py with `sudo mv application.py __init__.py`

   






      














  










###List of files in the Hangman game API folder
 - api.py: Contains endpoints and game playing logic.
 - app.yaml: App configuration.
 - cron.yaml: Cronjob configuration.
 - main.py: Handler for taskqueue handler.
 - models.py: Entity and message definitions including helper methods.
 - utils.py: Helper functions.

###Setting up the Hangman API
Replace the value of application in app.yaml file to the app ID you have registered in the Google App Engine admin console and would like to use to host your instance of this sample. 

- Visit https://console.developers.google.com/ to register and get an app ID.

  - Please ensure you have Python version 2.7, Google App engine launcher installed on your machine. Then start  the Google App engine launcher, add the Hangman game API folder and first run the application on local host by clicking 'Run'. Check the log for any errors by clicking the'Log' button. Next, deploy this app to Google App Engine by clicking 'Deploy'. Closely examine the log for any errors. Once the messages 'Process exited with code 0' and 'Completed update of app' get displayed, know that the app has been sucessfully deployed to Google App Engine.

  - To test the Hangman API endpoints, use the Google API Explorer tool by going to the below url in your   browser:

    https://**YOUR_APP_ID**.appspot.com/_ah/api/explorer
 
  - Click on the hangman API to see all the endpoints.

###Hangman Game Description
This is a one-player guessing game where you have to guess a randomly chosen word, by entering a single letter at a time. You have seven attempts to guess the word correctly else you lose the game. Each time you make a correct guess, the series of asterixes representing the word get filled with the correctly guessed letter. If you correctly guess all the letters in the word, all the asterixes dissapear and the word appears.
- Any game can be retrieved or played by using the path parameter **urlsafe_game_key**.
- You cannot guess an entire word nor can you input any numbers or special characters in a guess. 

###Score-Keeping in the Hangman game
- Any User can either win or lose a game.
- To know a User's Score, a simple mechanism has been implemented that computes the difference between the number of games won and the number of game lost for each user.
- Users' whose scores are zero get an email reminder every 12 hours telling them to improve their performance.

###List of API Endpoints 
 - **create_user**
    - Path: 'user'
    - Method: POST
    - Parameters: user_name, email (optional)
    - Returns: Message confirming creation of the User.
    - Description: Creates a new User. user_name provided must be unique. Will 
    raise a ConflictException if a User with that user_name already exists.
    
 - **new_game**
    - Path: 'game'
    - Method: POST
    - Parameters: user_name, min, max, attempts
    - Returns: GameForm with initial game state.
    - Description: Creates a new Game. user_name provided must correspond to an
    existing user - will raise a NotFoundException if not. Min must be less than
    max. Also adds a task to a task queue to update the average moves remaining
    for active games.
     
 - **get_game**
    - Path: 'game/{urlsafe_game_key}'
    - Method: GET
    - Parameters: urlsafe_game_key
    - Returns: GameForm with current game state.
    - Description: Returns the current state of a game.
    
 - **make_move**
    - Path: 'game/{urlsafe_game_key}'
    - Method: PUT
    - Parameters: urlsafe_game_key, guess
    - Returns: GameForm with new game state.
    - Description: Accepts a 'guess' and returns the updated state of the game.
    If this causes a game to end, a corresponding Score entity will be created.
    
 - **get_scores**
    - Path: 'scores'
    - Method: GET
    - Parameters: None
    - Returns: ScoreForms.
    - Description: Returns all Scores in the database (unordered).
    
 - **get_user_scores**
    - Path: 'scores/user/{user_name}'
    - Method: GET
    - Parameters: user_name
    - Returns: ScoreForms. 
    - Description: Returns all Scores recorded by the provided player (unordered).
    Will raise a NotFoundException if the User does not exist.
    
 - **get_average_attempts_remaining**
    - Path: 'games/average_attempts'
    - Method: GET
    - Parameters: None
    - Returns: StringMessage
    - Description: Gets the average number of attempts remaining for all games
    from a previously cached memcache key.

 - **get_user_games**
    - Path: 'games/user/{user_name}'
    - Method: GET
    - Parameters: None
    - Returns: GameForms
    - Description: Gets a user's active games
    
 - **cancel_game**
    - Path: 'game/{urlsafe_game_key}/cancel'
    - Method: PUT
    - Parameters: urlsafe_game_key
    - Returns: StringMessage
    - Description: Cancels any active game.

 - **get_high_scores**
    - Path: 'scores/highscores'
    - Method: GET
    - Parameters: number_of_results
    - Returns: RankingForms
    - Description: Provides the high scores 
    
 - **get_user_rankings**
    - Path: 'scores/rankings'
    - Method: GET
    - Parameters: None
    - Returns: RankingForms
    - Description: Provides ranking for all users
    
 - **get_game_history**
    - Path: 'sgame/{urlsafe_game_key}/history'
    - Method: GET
    - Parameters: urlsafe_game_key
    - Returns: StringMessage
    - Description: Reveals all User moves / guesses made in a specific game.  

###Forms description
 - **GameForm**
    - Represent's a Game's state. 
 - **HighScoreForm**
    - Handles the number of high scores
 - **NewGameForm**
    - Creates a new game.
 - **RankingForm**
    - Used for high scores and user ranking.
 - **ScoreForm**
    - Represents the score of a completed game.
 - **ScoreForms**
    - Multiple ScoreForm container.
 - **StringMessage**
    - General purpose String container.
 - **MakeMoveForm**
    - Handles user moves.         
 - **RankingForms**
    - Enables multiple rankings.
 - **GameForms**
    - Returns multiple GameForms.   

###Models Included:
 - **User**
    - Stores unique user_name and (optional) email address.

 - **Game**
    - Stores unique game states. Associated with User model via KeyProperty.

 - **Score**
    - Records completed games. Associated with Users model via KeyProperty. 

###ACKNOWLEGEMENT
Special thanks to `Udacity` for using their course materials to do this project. 








